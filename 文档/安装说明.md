# 项目安装说明

## ⚠️ 重要提示

由于系统 npm 缓存权限问题，建议先修复权限或使用其他方式安装依赖。

## 🔧 修复 npm 权限问题

在终端运行以下命令修复权限：

```bash
sudo chown -R $(whoami) ~/.npm
```

或者使用 pnpm（推荐）：

```bash
# 使用 corepack 启用 pnpm（Node.js 16.10+）
corepack enable
corepack prepare pnpm@latest --activate
```

## 📦 安装依赖

### 方式一：使用 pnpm（推荐）

#### 前端依赖

```bash
cd frontend
pnpm install
```

#### 后端依赖

```bash
cd backend
pnpm install
```

### 方式二：使用 npm

如果修复了权限问题，可以使用 npm：

#### 前端依赖

```bash
cd frontend
npm install
```

#### 后端依赖

```bash
cd backend
npm install
```

### 方式三：手动安装（如果上述方式都失败）

可以手动创建 `node_modules` 目录，然后逐个安装包，但这种方式不推荐。

## 🗄️ 数据库准备

### 创建数据库

```sql
CREATE DATABASE h5_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 配置后端环境变量

在 `backend` 目录下创建 `.env` 文件：

```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=h5_db

# Redis 配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWT 配置
JWT_SECRET=your_jwt_secret_key_change_this_in_production
JWT_EXPIRES_IN=7d

# 服务配置
PORT=3000
NODE_ENV=development
```

## 🚀 启动项目

### 1. 启动 MySQL

确保 MySQL 服务已启动。

### 2. 启动 Redis

确保 Redis 服务已启动。

### 3. 启动后端

```bash
cd backend
pnpm start:dev
# 或
npm run start:dev
```

后端服务运行在：http://localhost:3000
API 文档：http://localhost:3000/api-docs

### 4. 启动前端

```bash
cd frontend
pnpm dev
# 或
npm run dev
```

前端服务运行在：http://localhost:5173

## ✅ 验证安装

1. 访问 http://localhost:5173 应该能看到前端页面
2. 访问 http://localhost:3000/api-docs 应该能看到 Swagger API 文档
3. 检查后端控制台，应该能看到数据库连接成功的日志

## 🐛 常见问题

### 问题 1：npm 权限错误

**错误信息**：
```
npm ERR! code EPERM
npm ERR! syscall open
```

**解决方案**：
```bash
sudo chown -R $(whoami) ~/.npm
```

### 问题 2：数据库连接失败

**检查项**：
1. MySQL 服务是否启动
2. 数据库用户和密码是否正确
3. 数据库是否已创建
4. `.env` 文件配置是否正确

### 问题 3：Redis 连接失败

**检查项**：
1. Redis 服务是否启动
2. Redis 配置是否正确

### 问题 4：端口被占用

**解决方案**：
- 修改 `frontend/vite.config.ts` 中的端口（前端）
- 修改 `backend/.env` 中的 PORT（后端）

## 📝 下一步

安装完成后，请参考 [README.md](./README.md) 了解项目结构和使用方法。

