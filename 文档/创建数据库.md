# MySQL 安装和数据库创建指南

## 当前状态

检测到您的系统缺少 MySQL，需要先安装 MySQL 才能创建数据库。

## 安装方式

### 方式一：使用安装脚本（推荐）

由于网络连接问题，请在有网络的环境下执行：

```bash
chmod +x 安装MySQL.sh
./安装MySQL.sh
```

### 方式二：手动安装步骤

#### 1. 安装 Homebrew（如果未安装）

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

安装完成后，根据提示添加到 PATH：
```bash
# Apple Silicon (M1/M2)
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/opt/homebrew/bin/brew shellenv)"

# Intel
echo 'eval "$(/usr/local/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/usr/local/bin/brew shellenv)"
```

#### 2. 安装 MySQL

```bash
brew install mysql
```

#### 3. 启动 MySQL 服务

```bash
brew services start mysql
```

#### 4. 设置 MySQL root 密码（首次安装）

```bash
mysql_secure_installation
```

按照提示：
- 设置 root 密码
- 移除匿名用户（建议选择 Y）
- 禁止 root 远程登录（建议选择 Y）
- 移除 test 数据库（建议选择 Y）
- 重新加载权限表（选择 Y）

#### 5. 创建数据库

```bash
# 方式 1: 交互式（会提示输入密码）
mysql -u root -p

# 然后在 MySQL 命令行中执行：
CREATE DATABASE h5_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
SHOW DATABASES;
exit;

# 方式 2: 一行命令（需要输入密码）
mysql -u root -p -e "CREATE DATABASE h5_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 方式 3: 如果设置了无密码（不推荐）
mysql -u root -e "CREATE DATABASE h5_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

## 验证安装

### 检查 MySQL 是否安装成功

```bash
mysql --version
```

### 检查 MySQL 服务状态

```bash
brew services list | grep mysql
```

应该看到类似：
```
mysql  started  user  ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
```

### 验证数据库创建成功

```bash
mysql -u root -p -e "SHOW DATABASES LIKE 'h5_db';"
```

应该看到：
```
+------------------+
| Database (h5_db) |
+------------------+
| h5_db            |
+------------------+
```

## 常见问题

### 问题 1: 网络连接失败

如果安装 Homebrew 时网络连接失败：
1. 检查网络连接
2. 如果在中国，可能需要使用代理或镜像源
3. 可以手动下载 MySQL 安装包

### 问题 2: 权限问题

如果遇到权限问题：
```bash
sudo chown -R $(whoami) /usr/local/var/mysql
# 或
sudo chown -R $(whoami) /opt/homebrew/var/mysql
```

### 问题 3: MySQL 服务无法启动

```bash
# 查看错误日志
tail -f /usr/local/var/mysql/*.err
# 或
tail -f /opt/homebrew/var/mysql/*.err

# 重启服务
brew services restart mysql
```

### 问题 4: 忘记 root 密码

```bash
# 停止 MySQL
brew services stop mysql

# 以安全模式启动
mysqld_safe --skip-grant-tables &

# 连接 MySQL（无需密码）
mysql -u root

# 重置密码
USE mysql;
UPDATE user SET authentication_string=PASSWORD('新密码') WHERE User='root';
FLUSH PRIVILEGES;
exit;

# 重启 MySQL
brew services restart mysql
```

## 数据库文件位置

创建数据库后，文件会存储在：

- **Apple Silicon (M1/M2)**: `/opt/homebrew/var/mysql/h5_db/`
- **Intel**: `/usr/local/var/mysql/h5_db/`

## 下一步

数据库创建成功后，请：

1. 在 `backend` 目录创建 `.env` 文件
2. 配置数据库连接信息
3. 启动后端服务

参考 [安装说明.md](./安装说明.md) 中的环境变量配置部分。

